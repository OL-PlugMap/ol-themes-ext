{"version":3,"file":"staticVector.js","sources":["../src/staticVector.js"],"sourcesContent":["import VectorLayer from 'ol/layer/Vector';\r\nimport VectorSource from 'ol/source/Vector';\r\n\r\nimport { _styleFunction } from './vectorStyles'\r\n\r\n\r\n\r\n/**\r\n * Generates OpenLayers VectorLayer instances for static vector endpoints.\r\n *\r\n * @param {Object} data - The configuration object for the export.\r\n * @param {Object} data.config - The configuration details.\r\n * @param {Object} data.config.value - The main config values.\r\n * @param {Array}  data.config.value.endpoints - Array of endpoint objects to generate layers for.\r\n * @param {string} data.key - Unique identifier for the layer group.\r\n * @param {number} [data.opacity=1] - Opacity for the layers (default: 1).\r\n * @param {Object} core - Core context object, typically containing authentication and service info.\r\n * @returns {Array} Array of OpenLayers VectorLayer instances, one for each endpoint.\r\n *\r\n * Each endpoint object in `data.config.value.endpoints` can have:\r\n *   - zIndex {number}: Optional. z-index for the layer.\r\n *   - style {Function|Object}: Optional. Static or dynamic style function/object for the layer.\r\n */\r\nexport const generate = (data, core) => {\r\n    let layers = data.config.value.endpoints.map(endpoint => {\r\n        \r\n        let source = new VectorSource({\r\n          maxZoom: 15,\r\n        });\r\n\r\n        source.highlightFeats = {};\r\n\r\n\r\n        let vLayer = new VectorLayer({\r\n          declutter: true,\r\n          source: source,\r\n          zIndex: endpoint.zIndex || 1000\r\n        });\r\n\r\n        vLayer.style = _styleFunction(endpoint, source, vLayer);\r\n        vLayer.setStyle(_styleFunction(endpoint, source, vLayer))\r\n\r\n        vLayer.set('id', data.key);\r\n\r\n        vLayer.addGeoJSON = (geoJSON) => {\r\n          if (typeof geoJSON === 'string') {\r\n            geoJSON = JSON.parse(geoJSON);\r\n          }\r\n          if (geoJSON.type !== 'FeatureCollection') {\r\n            geoJSON = { type: 'FeatureCollection', features: [geoJSON] };\r\n          }\r\n          source.addFeatures(source.getFormat().readFeatures(geoJSON));\r\n        }\r\n        \r\n        return vLayer;\r\n      });\r\n\r\n    return layers;\r\n}\r\n\r\n/**\r\n * Builder for the static vector configuration object.\r\n *\r\n * Example usage:\r\n *   const config = new StaticVectorConfigBuilder()\r\n *     .setKey('myLayerGroup')\r\n *     .setOpacity(0.8)\r\n *     .addEndpoint({\r\n *       zIndex: 2,\r\n *       style: myStyleFunction // or a static style object\r\n *     })\r\n *     .build();\r\n */\r\nexport class StaticVectorConfigBuilder {\r\n  /**\r\n   * @param {Object} [initialConfig] - Optional initial configuration object.\r\n   */\r\n  constructor(initialConfig = {}) {\r\n    this._config = {\r\n      config: {\r\n        value: {\r\n          endpoints: [],\r\n          ...(initialConfig.config && initialConfig.config.value ? initialConfig.config.value : {})\r\n        },\r\n      },\r\n      key: initialConfig.key || '',\r\n      opacity: typeof initialConfig.opacity === 'number' ? initialConfig.opacity : 1,\r\n    };\r\n\r\n    if (\r\n      initialConfig.config &&\r\n      initialConfig.config.value &&\r\n      Array.isArray(initialConfig.config.value.endpoints)\r\n    ) {\r\n      this._config.config.value.endpoints = [...initialConfig.config.value.endpoints];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set the unique key for the layer group.\r\n   * @param {string} key\r\n   */\r\n  setKey(key) {\r\n    this._config.key = key;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set the opacity for the layers.\r\n   * @param {number} opacity\r\n   */\r\n  setOpacity(opacity) {\r\n    this._config.opacity = opacity;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Add an endpoint configuration with validation.\r\n   * @param {Object} endpoint\r\n   * @param {number} [endpoint.zIndex] - Optional z-index for the layer.\r\n   * @param {Function|Object} [endpoint.style] - Optional static or dynamic style.\r\n   * @throws {Error} If required parameters are invalid.\r\n   */\r\n  addEndpoint(endpoint) {\r\n    if (!endpoint || typeof endpoint !== 'object') {\r\n      throw new Error('Endpoint must be an object.');\r\n    }\r\n    if (endpoint.zIndex && typeof endpoint.zIndex !== 'number') {\r\n      throw new Error('Endpoint \"zIndex\" must be a number if provided.');\r\n    }\r\n    // style can be a function or an object, so no strict validation\r\n\r\n    this._config.config.value.endpoints.push(endpoint);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Build and return the configuration object.\r\n   * @returns {Object}\r\n   */\r\n  build() {\r\n    return this._config;\r\n  }\r\n}"],"names":[],"mappings":"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"}